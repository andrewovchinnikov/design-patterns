# Легковесный объект (Flyweight)

### **Описание**

**Flyweight (Легковесный объект)**: Определяет структуру для совместного использования объектов. Легковесный объект используется для эффективного управления памятью, когда необходимо создать большое количество объектов с одинаковыми или похожими состояниями.

**FlyweightFactory (Фабрика легковесных объектов)**: Создает и управляет легковесными объектами. Обеспечивает повторное использование объектов, чтобы минимизировать использование памяти.

**ConcreteFlyweight (Конкретный легковесный объект)**: Реализует интерфейс легковесного объекта и хранит внутреннее состояние, которое может быть общим для нескольких объектов.

**UnsharedConcreteFlyweight (Неразделяемый конкретный легковесный объект)**: Реализует интерфейс легковесного объекта, но не делит свое состояние с другими объектами.

### **UML Диаграмма**

```plaintext
@startuml
interface Flyweight {
    +operation(extrinsicState: UniqueState)
}

class ConcreteFlyweight implements Flyweight {
    -intrinsicState: SharedState
    +operation(extrinsicState: UniqueState)
}

class UnsharedConcreteFlyweight implements Flyweight {
    -allState: UniqueState
    +operation(extrinsicState: UniqueState)
}

class FlyweightFactory {
    -flyweights: Map<String, Flyweight>
    +getFlyweight(key: String): Flyweight
}

Flyweight <|-- ConcreteFlyweight
Flyweight <|-- UnsharedConcreteFlyweight
FlyweightFactory --> Flyweight
@enduml
```

### **Описание элементов**

**Flyweight (Легковесный объект)**:

* `operation(extrinsicState: UniqueState)`: Операция, которая принимает внешнее состояние и выполняет действие с использованием внутреннего и внешнего состояния.

**ConcreteFlyweight (Конкретный легковесный объект)**:

* `intrinsicState: SharedState`: Внутреннее состояние, которое является общим для нескольких объектов.
* `operation(extrinsicState: UniqueState)`: Реализация операции, использующая внутреннее и внешнее состояние.

**UnsharedConcreteFlyweight (Неразделяемый конкретный легковесный объект)**:

* `allState: UniqueState`: Уникальное состояние, которое не делится с другими объектами.
* `operation(extrinsicState: UniqueState)`: Реализация операции, использующая уникальное состояние.

**FlyweightFactory (Фабрика легковесных объектов)**:

* `flyweights: Map<String, Flyweight>`: Хранилище легковесных объектов.
* `getFlyweight(key: String): Flyweight`: Возвращает легковесный объект по ключу. Если объект не существует, создает новый и добавляет его в хранилище.

### **Преимущества**

* **Экономия памяти**: Позволяет значительно сократить использование памяти за счет повторного использования объектов.
* **Эффективность**: Уменьшает нагрузку на систему при работе с большим количеством объектов.
* **Гибкость**: Позволяет легко добавлять новые виды объектов в систему.

### **Недостатки**

* **Сложность**: Может усложнить дизайн системы из-за необходимости разделения внутреннего и внешнего состояния.
* **Ограничения**: Не всегда подходит для ситуаций, где объекты имеют уникальные состояния.

### **Применение**

* Когда нужно представлять большое количество объектов с одинаковыми или похожими состояниями.
* Когда необходимо экономить память и ресурсы системы.
* Когда внешнее состояние объектов может быть вынесено за пределы объектов.

### **Примеры**

* **Текстовые редакторы**: Символы в тексте могут быть представлены как легковесные объекты, где внутреннее состояние включает шрифт и размер, а внешнее состояние — позицию в тексте.
* **Графические редакторы**: Графические объекты (линии, круги) могут быть представлены как легковесные объекты, где внутреннее состояние включает цвет и стиль, а внешнее состояние — координаты.
* **Игры**: Игровые объекты (например, деревья в лесу) могут быть представлены как легковесные объекты, где внутреннее состояние включает текстуру и модель, а внешнее состояние — позицию на карте.

Паттерн Легковесный объект является мощным инструментом для эффективного управления памятью и ресурсами системы при работе с большим количеством объектов с одинаковыми или похожими состояниями.
